// src/app/api/chat/route.ts 
import { NextRequest, NextResponse } from 'next/server';
import OpenAI from 'openai';

const client = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

function languageName(locale: string): string {
  switch (locale) {
    case 'ru':
      return 'Russian';
    case 'kk':
      return 'Kazakh';
    case 'zh':
      return 'Chinese';
    default:
      return 'English';
  }
}

/**
 * ç®€å•çŸ¥è¯†åº“ï¼š
 * - åé¢ä½ å¯ä»¥æŠŠè¿™é‡Œçš„æ–‡æœ¬æ”¹æˆçœŸæ­£çš„ã€ŠĞ Ğ½Ğ°Ñã€‹ã€ŠĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğµ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ğµã€‹ã€ŠĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ´ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ã€‹å†…å®¹
 * - è¿™é‡Œåªæ˜¯ç»“æ„ç¤ºä¾‹
 */
function getPageKnowledge(pageContext: string, locale: string): string {
  const ctx = pageContext.toLowerCase();

  const isFaq =
    ctx.includes('faq') ||
    ctx.includes('Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹') ||
    ctx.includes('Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹') ||
    ctx.includes('/faq');

  const isAbout =
    ctx.includes('about') ||
    ctx.includes('Ğ¾ Ğ½Ğ°Ñ') ||
    ctx.includes('/about') ||
    ctx.includes('/about-us');

  // ä¿ç•™åŸæ¥ terms/agreement æ£€æµ‹ï¼Œå…¼å®¹è€é€»è¾‘
  const isUserAgreement =
    ctx.includes('user-agreement') ||
    ctx.includes('agreement') ||
    ctx.includes('/terms') ||
    ctx.includes('Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğµ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ğµ');

  const isPrivacy =
    ctx.includes('privacy') ||
    ctx.includes('/privacy') ||
    ctx.includes('confidentiality') ||
    ctx.includes('Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ´ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸');

  // âœ… FAQ çŸ¥è¯†åº“
  if (isFaq) {
    if (locale === 'ru') {
      return `
Ğ­Ñ‚Ğ¾ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ¾Ğµ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ñƒ FAQ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹ Onerinn.

1. ĞšÑ€Ğ°Ñ‚ĞºĞ¾ Ğ¾ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğµ
- Onerinn â€” ÑÑ‚Ğ¾ Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½-Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ´Ğ»Ñ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ¸ĞºĞ¸ Ğ¸ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸/Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğ¹ Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²Ğ°.
- ĞĞ° Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğµ ĞµÑÑ‚ÑŒ Ğ´Ğ²Ğ° Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:
  â€¢ ĞÑ€ĞµĞ½Ğ´Ğ° Ğ¸ Ğ¿Ñ€Ğ¾ĞºĞ°Ñ‚ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ¸ĞºĞ¸.
  â€¢ Ğ’Ñ‹ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ° Ñ…ÑƒĞ´Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğ¹ (ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½Ñ‹, Ğ¿Ğ¾ÑÑ‚ĞµÑ€Ñ‹ Ğ¸ Ğ´Ñ€.).

2. Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ²Ñ…Ğ¾Ğ´
- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ¿Ğ¾ Ğ°Ğ´Ñ€ĞµÑÑƒ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ¹ Ğ¿Ğ¾Ñ‡Ñ‚Ñ‹ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾ Ğ½Ğ¾Ğ¼ĞµÑ€Ñƒ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ° (Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ· Ğ½Ğ¸Ñ…).
- ĞŸÑ€Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ:
  â€¢ Ğ˜Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ;
  â€¢ e-mail Ğ¸Ğ»Ğ¸ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½;
  â€¢ ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ.
- Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ Ğ¿Ğ¾ e-mail.

3. ĞÑ€ĞµĞ½Ğ´Ğ° ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² Ğ½Ğ° Onerinn
- Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ°Ñ€ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾:
  1) Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞ¹Ñ‚ĞµÑÑŒ Ğ¸ Ğ²Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚.
  2) ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ» "ĞÑ€ĞµĞ½Ğ´Ğ°" Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾.
  3) ĞĞ·Ğ½Ğ°ĞºĞ¾Ğ¼ÑŒÑ‚ĞµÑÑŒ Ñ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼, ÑƒÑĞ»Ğ¾Ğ²Ğ¸ÑĞ¼Ğ¸ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹, Ğ·Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ¼ Ğ¸ ÑÑ€Ğ¾ĞºĞ°Ğ¼Ğ¸.
  4) ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ "ĞÑ€ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ñ‚ÑŒ" Ğ¸ ÑĞ»ĞµĞ´ÑƒĞ¹Ñ‚Ğµ ÑˆĞ°Ğ³Ğ°Ğ¼ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ·Ğ°ĞºĞ°Ğ·Ğ°.
  5) ĞŸĞ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ·Ğ°ĞºĞ°Ğ·Ğ° Ñ Ğ²Ğ°Ğ¼Ğ¸ ÑĞ²ÑĞ¶ĞµÑ‚ÑÑ Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ¸Ğ»Ğ¸ ÑĞ»ÑƒĞ¶Ğ±Ğ° Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°.

4. ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ°/Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğ¹ Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²Ğ°
- Ğ¥ÑƒĞ´Ğ¾Ğ¶Ğ½Ğ¸ĞºĞ¸ Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ñ†Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚:
  â€¢ Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ½Ğ° Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğµ;
  â€¢ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ ÑĞ²Ğ¾Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ñ„Ğ¾Ñ‚Ğ¾, Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼, Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ°Ğ¼Ğ¸ Ğ¸ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ°Ğ¼Ğ¸;
  â€¢ Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ñ†ĞµĞ½Ñƒ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸ Ğ¸Ğ»Ğ¸ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹ (ĞµÑĞ»Ğ¸ Ğ¿Ñ€ĞµĞ´ÑƒÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ğ¾).
- ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»Ğ¸:
  â€¢ ĞŸÑ€Ğ¾ÑĞ¼Ğ°Ñ‚Ñ€Ğ¸Ğ²Ğ°ÑÑ‚ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğ¹;
  â€¢ ĞœĞ¾Ğ³ÑƒÑ‚ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ² "Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ" Ğ¸ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ÑÑ‚ÑŒ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºÑƒ.

5. Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ±Ñ‹ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹ Ğ½Ğ° Onerinn
- Ğ”Ğ»Ñ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ° Onerinn.kz (ĞšĞ°Ğ·Ğ°Ñ…ÑÑ‚Ğ°Ğ½):
  â€¢ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ñ‹ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹: Kaspi, Halyk Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ĞºĞ°Ğ·Ğ°Ñ…ÑÑ‚Ğ°Ğ½ÑĞºĞ¸Ğµ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹.
- Ğ”Ğ»Ñ Ğ´Ğ¾Ğ¼ĞµĞ½Ğ° Onerinn.com:
  â€¢ ĞŸÑ€ĞµĞ´ÑƒÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ñ‹ Ğ¼ĞµĞ¶Ğ´ÑƒĞ½Ğ°Ñ€Ğ¾Ğ´Ğ½Ñ‹Ğµ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ñ‹ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹: Ğ±Ğ°Ğ½ĞºĞ¾Ğ²ÑĞºĞ¸Ğµ ĞºĞ°Ñ€Ñ‚Ñ‹, Ğ° Ñ‚Ğ°ĞºĞ¶Ğµ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½-Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ¸ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, PayPal/Stripe/Apple Pay â€” Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸).
- ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ¿ĞµÑ€ĞµÑ‡ĞµĞ½ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ¾Ğ² Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½ Ğ¿Ñ€Ğ¸ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ·Ğ°ĞºĞ°Ğ·Ğ°.
- ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ½Ñ‹Ğµ ÑˆĞ»ÑĞ·Ñ‹, ÑĞ°Ğ¼Ğ¸ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (Ğ½Ğ¾Ğ¼ĞµÑ€ ĞºĞ°Ñ€Ñ‚Ñ‹ Ğ¸ Ñ‚.Ğ¿.) Ğ½Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ½Ğ° Onerinn.

6. ĞšĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹
- ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Onerinn Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²Ğ·Ğ¸Ğ¼Ğ°Ñ‚ÑŒ ÑĞµÑ€Ğ²Ğ¸ÑĞ½ÑƒÑ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¹ ÑĞ´ĞµĞ»ĞºĞ¸.
- Ğ¢Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ğ¸ Ğ¸ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ ĞµÑ‘ Ğ²Ğ·Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹ Ğ² ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ¼ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ğ¸ Ğ¸/Ğ¸Ğ»Ğ¸ Ğ² ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞµ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ ÑƒÑĞ»ÑƒĞ³Ğ¸.

7. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ¸ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ°
- Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹ Ğ·Ğ°ĞºĞ°Ğ·Ğ° Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° ÑÑ€ĞµĞ´ÑÑ‚Ğ² Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‚ Ğ¾Ñ‚:
  â€¢ ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ğ¸Ğ»Ğ¸ ÑƒÑĞ»ÑƒĞ³Ğ¸;
  â€¢ ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ñ†Ğ°/Ğ°Ñ€ĞµĞ½Ğ´Ğ¾Ğ´Ğ°Ñ‚ĞµĞ»Ñ.
- ĞĞ±Ñ‰Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ Ğ¸ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¸Ğ·Ğ»Ğ¾Ğ¶ĞµĞ½Ñ‹ Ğ² ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ¼ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ğ¸ Ğ¸ Ğ² Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğµ FAQ.

8. ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°
- ĞŸÑ€Ğ¸ Ğ²Ğ¾Ğ·Ğ½Ğ¸ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚:
  â€¢ ĞĞ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒÑÑ Ğº Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸ĞºÑƒ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ (Onerinn Assistant);
  â€¢ ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ² ÑĞ»ÑƒĞ¶Ğ±Ñƒ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸ Ğ¿Ğ¾ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ°Ğ¼, ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¼ Ğ² Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğµ "Ğ Ğ½Ğ°Ñ" Ğ¸Ğ»Ğ¸ "ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹".
      `.trim();
    }

    if (locale === 'kk') {
      return `
Ğ‘Ò±Ğ» Onerinn FAQ Ğ±Ó©Ğ»Ñ–Ğ¼Ñ–Ğ½Ñ–Ò£ Ò›Ñ‹ÑÒ›Ğ°ÑˆĞ° Ğ¼Ğ°Ğ·Ğ¼Ò±Ğ½Ñ‹:

- Onerinn â€” ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ¸ĞºĞ° Ğ¶Ğ°Ğ»Ò“Ğ° Ğ°Ğ»Ñƒ Ğ¶Ó™Ğ½Ğµ Ó©Ğ½ĞµÑ€ Ñ‚ÑƒÑ‹Ğ½Ğ´Ñ‹Ğ»Ğ°Ñ€Ñ‹Ğ½ ÑĞ°Ñ‚Ñƒ/ÑĞ°Ñ‚Ñ‹Ğ¿ Ğ°Ğ»Ñƒ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°ÑÑ‹.
- Onerinn Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°ÑÑ‹ 2025 Ğ¶Ñ‹Ğ»Ñ‹ Ğ¢ĞĞ Â«OnerinnÂ» Ñ‚Ğ°Ñ€Ğ°Ğ¿Ñ‹Ğ½Ğ°Ğ½ Ò›Ò±Ñ€Ñ‹Ğ»Ğ´Ñ‹. Ğ–Ğ¾Ğ±Ğ°Ğ½Ñ‹Ò£ Ğ¼Ğ°Ò›ÑĞ°Ñ‚Ñ‹ â€” ÑÑƒÑ€ĞµÑ‚ÑˆÑ–Ğ»ĞµÑ€ Ğ¼ĞµĞ½ ÑÑ‚ÑƒĞ´ĞµĞ½Ñ‚Ñ‚ĞµÑ€Ğ³Ğµ Ó©Ğ· Ğ¶Ò±Ğ¼Ñ‹ÑÑ‚Ğ°Ñ€Ñ‹Ğ½ ĞºÓ©Ñ€ÑĞµÑ‚ÑƒĞ³Ğµ Ğ¶Ó™Ğ½Ğµ ÑˆÑ‹Ò“Ğ°Ñ€Ğ¼Ğ°ÑˆÑ‹Ğ»Ñ‹Ò“Ñ‹Ğ½ Ğ½Ğ°Ò›Ñ‚Ñ‹ Ò›Ò±Ğ½Ğ´Ñ‹Ğ»Ñ‹Ò›Ò›Ğ° Ğ°Ğ¹Ğ½Ğ°Ğ»Ğ´Ñ‹Ñ€ÑƒÒ“Ğ° Ğ¼Ò¯Ğ¼ĞºÑ–Ğ½Ğ´Ñ–Ğº Ğ±ĞµÑ€Ñƒ, ÑĞ¾Ğ½Ğ´Ğ°Ğ¹-Ğ°Ò› Ğ·Ğ°Ğ¼Ğ°Ğ½Ğ°ÑƒĞ¸ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ´Ñ‹ Ò›Ò±Ñ€Ñ‹Ğ»Ò“Ñ‹Ğ»Ğ°Ñ€Ğ´Ñ‹ Ğ¶Ğ°Ğ»Ò“Ğ° Ğ°Ğ»Ñƒ Ğ¼ĞµĞ½ ĞºĞµĞ¹ Ğ¶Ğ°Ò“Ğ´Ğ°Ğ¹Ğ´Ğ° Ñ‚ĞµĞ³Ñ–Ğ½ Ğ°Ğ»ÑƒĞ´Ñ‹ Ò›Ğ¾Ğ»Ğ¶ĞµÑ‚Ñ–Ğ¼Ğ´Ñ– ĞµÑ‚Ñƒ.
- ĞŸĞ°Ğ¹Ğ´Ğ°Ğ»Ğ°Ğ½ÑƒÑˆÑ‹Ğ»Ğ°Ñ€ e-mail Ğ½ĞµĞ¼ĞµÑĞµ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½ Ğ½Ó©Ğ¼Ñ–Ñ€Ñ– Ğ°Ñ€Ò›Ñ‹Ğ»Ñ‹ Ñ‚Ñ–Ñ€ĞºĞµĞ»Ğµ Ğ°Ğ»Ğ°Ğ´Ñ‹.
- Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ° ĞºÒ¯Ğ½Ğ³Ğµ/Ğ°Ğ¿Ñ‚Ğ°Ò“Ğ°/Ğ°Ğ¹Ò“Ğ° Ğ¶Ğ°Ğ»Ò“Ğ° Ğ±ĞµÑ€Ñ–Ğ»ÑƒÑ– Ğ¼Ò¯Ğ¼ĞºÑ–Ğ½, ĞºĞµĞ¿Ñ–Ğ» ÑĞ¾Ğ¼Ğ°ÑÑ‹ Ğ±Ğ°Ñ€.
- Ğ¢Ó©Ğ»ĞµĞ¼ ÑÓ™Ñ‚Ñ‚Ñ– Ó©Ñ‚ĞºĞµĞ½ ĞºĞµĞ·Ğ´Ğµ ÑĞµÑ€Ğ²Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸ÑÑÑ‹ Ò±ÑÑ‚Ğ°Ğ»Ğ°Ğ´Ñ‹.
- Ğ”Ğ°ÑƒĞ»Ğ°Ñ€ Ğ¼ĞµĞ½ ÑˆĞ°Ò“Ñ‹Ğ¼Ğ´Ğ°Ñ€Ğ´Ñ‹ Ò›Ğ¾Ğ»Ğ´Ğ°Ñƒ Ğ±Ó©Ğ»Ñ–Ğ¼Ñ– Ğ°Ñ€Ò›Ñ‹Ğ»Ñ‹ Ğ¶Ğ¾Ğ»Ğ´Ğ°ÑƒÒ“Ğ° Ğ±Ğ¾Ğ»Ğ°Ğ´Ñ‹.
      `.trim();
    }

    if (locale === 'zh') {
      return `
è¿™é‡Œæ˜¯ Onerinn å¹³å° FAQ çš„çŸ¥è¯†æ‘˜è¦ï¼ˆä¸­æ–‡ï¼‰ï¼š

- Onerinn æ˜¯ä¸€ä¸ªçº¿ä¸Šå¹³å°ï¼Œä¸»è¦æä¾›ç”µå­äº§å“ç§Ÿèµå’Œè‰ºæœ¯å“å±•ç¤º/ä¹°å–ä¸¤å¤§æ¿å—ã€‚
- ç”¨æˆ·å¯ä»¥é€šè¿‡é‚®ç®±æˆ–æ‰‹æœºæ³¨å†Œï¼ˆåªéœ€è¦å¡«å†™å…¶ä¸­ä¸€ä¸ªå³å¯ï¼‰ï¼Œç™»å½•åå°±èƒ½æµè§ˆå’Œä¸‹å•ã€‚
- åœ¨ Onerinn.kz åŸŸåä¸‹ï¼Œæ”¯æŒ Kaspiã€Halyk ç­‰æœ¬åœ°å“ˆè¨å…‹æ”¯ä»˜æ–¹å¼ï¼›
- åœ¨ Onerinn.com åŸŸåä¸‹ï¼Œæ”¯æŒå›½é™…é“¶è¡Œå¡åŠéƒ¨åˆ†å›½é™…æ”¯ä»˜æ–¹å¼ï¼ˆä¾‹å¦‚ PayPal/Stripe/Apple Pay ç­‰ï¼Œå…·ä½“ä»¥ä¸‹å•é¡µé¢ä¸ºå‡†ï¼‰ã€‚
- å¹³å°åœ¨æ¯ä¸€ç¬”æˆåŠŸäº¤æ˜“ä¸­å¯èƒ½æ”¶å–æœåŠ¡è´¹ï¼Œå…·ä½“è´¹ç‡ä»¥ç”¨æˆ·åè®®æˆ–è®¢å•é¡µé¢è¯´æ˜ä¸ºå‡†ã€‚
- æ›´å¤šç»†èŠ‚è¯·å‚è§ç”¨æˆ·åè®®ã€éšç§æ”¿ç­–ä»¥åŠå¹³å°â€œå…³äºæˆ‘ä»¬â€é¡µé¢ã€‚
      `.trim();
    }

    // é»˜è®¤è‹±æ–‡ï¼šä¿ç•™åŸæ¥çš„è‹±æ–‡ç®€ç‰ˆ
    return `
This is a short summary of the Onerinn FAQ:

- Onerinn is a platform for renting electronics and buying/selling artworks.
- The Onerinn platform was created in 2025 by LLP "Onerinn". The idea is to help artists and students showcase their work and turn creativity into real value, while also making modern electronics accessible through rentals and some free-to-own offers.
- Users can register with either e-mail or phone number.
- Devices can be rented per day / week / month, with a security deposit.
- The platform charges a service fee after a successful payment, depending on category and service type.
- Disputes and complaints can be sent via the support section / disputes section, where Onerinn will help resolve the issue.
    `.trim();
  }

  // âœ… About / Ğ Ğ½Ğ°Ñ
  if (isAbout) {
    if (locale === 'ru') {
      return `
Ğ Ğ°Ğ·Ğ´ĞµĞ» "Ğ Ğ½Ğ°Ñ" Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹ Onerinn:

- Onerinn â€” ÑÑ‚Ğ¾ Ğ¼Ğ¾Ğ»Ğ¾Ğ´Ğ°Ñ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°, ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ´Ğ»Ñ Ñ‚Ğ¾Ğ³Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ñ€ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ¸ĞºĞ¸ Ğ¸ Ğ¼Ğ¸Ñ€ Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²Ğ°.
- ĞĞ°ÑˆĞµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ¾Ñ‚ ĞºĞ°Ğ·Ğ°Ñ…ÑĞºĞ¾Ğ³Ğ¾ ÑĞ»Ğ¾Ğ²Ğ° "Ó¨Ğ½ĞµÑ€" (Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²Ğ¾) Ğ¸ Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¾Ğ³Ğ¾ "inn" (Ğ³Ğ¾ÑÑ‚ĞµĞ²Ğ¾Ğ¹ Ğ´Ğ¾Ğ¼, Ğ¼ĞµÑÑ‚Ğ¾ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ¸).
- ĞœÑ‹ ÑÑ‚Ñ€ĞµĞ¼Ğ¸Ğ¼ÑÑ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ°Ñ€ĞµĞ½Ğ´Ñƒ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ¸ Ğ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾Ğ¹, Ğ° Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ñƒ Ğ¸ Ğ°Ñ€ĞµĞ½Ğ´Ñƒ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğ¹ Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²Ğ° â€” Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾Ğ¹ ĞºĞ°Ğº Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ², Ñ‚Ğ°Ğº Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ĞµĞ¹.
- ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑĞ·Ñ‹ĞºĞ¾Ğ² (ĞºĞ°Ğ·Ğ°Ñ…ÑĞºĞ¸Ğ¹, Ñ€ÑƒÑÑĞºĞ¸Ğ¹, Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğ¹ Ğ¸ Ğ´Ñ€.) Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ğ¾Ğ´ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ´ Ñ€ĞµĞ³Ğ¸Ğ¾Ğ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.
      `.trim();
    }

    if (locale === 'kk') {
      return `
ĞĞ½ĞµÑ€Ğ¸Ğ½Ğ½ Ñ‚ÑƒÑ€Ğ°Ğ»Ñ‹:

Onerinn â€” ÒšĞ°Ğ·Ğ°Ò›ÑÑ‚Ğ°Ğ½Ğ´Ğ° Ò›Ò±Ñ€Ñ‹Ğ»Ò“Ğ°Ğ½ Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°. ĞœÒ±Ğ½Ğ´Ğ° Ğ±Ñ–Ñ€ Ğ¶Ğ°Ò“Ñ‹Ğ½Ğ°Ğ½ ÑĞ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ¸ĞºĞ°Ğ½Ñ‹ Ğ¶Ğ°Ğ»Ò“Ğ° Ğ°Ğ»ÑƒÒ“Ğ°, ĞµĞºÑ–Ğ½ÑˆÑ– Ğ¶Ğ°Ò“Ñ‹Ğ½Ğ°Ğ½ Ó©Ğ½ĞµÑ€ Ñ‚ÑƒÑ‹Ğ½Ğ´Ñ‹Ğ»Ğ°Ñ€Ñ‹Ğ½ ĞºÓ©Ñ€ÑĞµÑ‚ÑƒĞ³Ğµ Ğ¶Ó™Ğ½Ğµ ÑĞ°Ñ‚ÑƒÒ“Ğ° Ğ±Ğ¾Ğ»Ğ°Ğ´Ñ‹. ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ½Ñ‹Ò£ Ğ¼Ğ°Ò›ÑĞ°Ñ‚Ñ‹ â€” Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ°Ğ½Ñ‹ Ò›Ğ¾Ğ»Ğ¶ĞµÑ‚Ñ–Ğ¼Ğ´Ñ– ĞµÑ‚Ñƒ Ğ¶Ó™Ğ½Ğµ ÑÑƒÑ€ĞµÑ‚ÑˆÑ–Ğ»ĞµÑ€Ğ³Ğµ Ó©Ğ· Ğ¶Ò±Ğ¼Ñ‹ÑÑ‚Ğ°Ñ€Ñ‹Ğ½ ĞºÓ©Ñ€ÑĞµÑ‚Ñƒ Ğ°Ñ€Ğ½Ğ°ÑÑ‹Ğ½ Ğ±ĞµÑ€Ñƒ.
      `.trim();
    }

    if (locale === 'zh') {
      return `
Onerinn â€œå…³äºæˆ‘ä»¬â€ é¡µé¢æ ¸å¿ƒå†…å®¹æ‘˜è¦ï¼ˆä¸­æ–‡ï¼‰ï¼š

- Onerinn åç§°æ¥æºäºå“ˆè¨å…‹è¯­ â€œÓ¨Ğ½ĞµÑ€ï¼ˆè‰ºæœ¯ï¼‰â€ å’Œè‹±æ–‡ â€œinnï¼ˆå°æ—…é¦†ï¼é©¿ç«™ï¼‰â€ï¼Œå¯“æ„â€œä¸ºè‰ºæœ¯ä¸åˆ›æ„æä¾›ä¸€ä¸ªå¯ä»¥åœé çš„æ¸¯æ¹¾â€ã€‚
- å¹³å°æä¾›ç”µå­äº§å“ç§Ÿèµä¸è‰ºæœ¯å“å±•ç¤º/äº¤æ˜“ä¸¤å¤§åŠŸèƒ½ï¼Œä¸ºæ™®é€šç”¨æˆ·ã€è‰ºæœ¯å®¶å’Œç§Ÿèµæ–¹æ­å»ºæ¡¥æ¢ã€‚
- ç½‘ç«™æ”¯æŒå¤šè¯­è¨€ï¼Œå¹¶æ ¹æ®ç”¨æˆ·æ‰€åœ¨åœ°åŒºè‡ªåŠ¨åˆ‡æ¢è¯­è¨€ä¸æ”¯ä»˜æ–¹å¼ï¼ŒåŒæ—¶ä¹Ÿå…è®¸ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©è¯­è¨€ã€‚
      `.trim();
    }

    return `
About Onerinn:

Onerinn is an online platform founded in Kazakhstan that combines electronics rentals with an online gallery and marketplace for artworks. The goal is to make devices more accessible via rentals while giving artists a convenient way to showcase and sell their works.
    `.trim();
  }

  // âœ… ç”¨æˆ·åè®® / User Agreement
  if (isUserAgreement) {
    if (locale === 'ru') {
      return `
ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ñ Onerinn (Ğ¾Ğ±Ñ‰ĞµĞµ Ñ€ĞµĞ·ÑĞ¼Ğµ):

- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ, Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒÑÑÑŒ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ, Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´Ğ°ĞµÑ‚ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¸Ğµ Ñ ÑƒÑĞ»Ğ¾Ğ²Ğ¸ÑĞ¼Ğ¸.
- ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ñ Ğ¾Ğ±ÑŠÑĞ²Ğ»ĞµĞ½Ğ¸Ğ¹, Ğ°Ñ€ĞµĞ½Ğ´Ğµ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸ Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğµ/Ğ°Ñ€ĞµĞ½Ğ´Ğµ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğ¹ Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²Ğ°.
- ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ Ğ·Ğ° Ğ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°, Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ğ¸ ÑĞ¾Ğ±Ğ»ÑĞ´ĞµĞ½Ğ¸Ğµ Ğ·Ğ°ĞºĞ¾Ğ½Ğ¾Ğ² Ğ½ĞµÑÑƒÑ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ñ†Ñ‹/Ğ°Ñ€ĞµĞ½Ğ´Ğ¾Ğ´Ğ°Ñ‚ĞµĞ»Ğ¸.
- ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ½Ğµ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ¾Ğ¹ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ° ĞºÑƒĞ¿Ğ»Ğ¸-Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸/Ğ°Ñ€ĞµĞ½Ğ´Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸, Ğ° Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ¿Ğ»Ğ¾Ñ‰Ğ°Ğ´ĞºÑƒ.
- Ğ’ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ğ¸ Ñ€ĞµĞ³ÑƒĞ»Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ¾Ğ², Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½ Ğ¸ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ ÑĞ¿Ğ¾Ñ€Ğ¾Ğ².
      `.trim();
    }

    if (locale === 'kk') {
      return `
Onerinn Ğ¿Ğ°Ğ¹Ğ´Ğ°Ğ»Ğ°Ğ½ÑƒÑˆÑ‹ ĞºĞµĞ»Ñ–ÑÑ–Ğ¼Ñ–Ğ½Ñ–Ò£ Ò›Ñ‹ÑÒ›Ğ°ÑˆĞ° Ğ½Ò±ÑÒ›Ğ°ÑÑ‹:

- Ğ¢Ñ–Ñ€ĞºĞµĞ»Ñƒ ĞºĞµĞ·Ñ–Ğ½Ğ´Ğµ Ğ¿Ğ°Ğ¹Ğ´Ğ°Ğ»Ğ°Ğ½ÑƒÑˆÑ‹ ÑˆÑ‹Ğ½Ğ°Ğ¹Ñ‹ Ğ´ĞµÑ€ĞµĞºÑ‚ĞµÑ€ ĞºÓ©Ñ€ÑĞµÑ‚ÑƒĞ³Ğµ Ğ¼Ñ–Ğ½Ğ´ĞµÑ‚Ñ‚Ñ–.
- Ğ–Ğ°Ñ€Ğ½Ğ°Ğ¼Ğ° Ğ¾Ñ€Ğ½Ğ°Ğ»Ğ°ÑÑ‚Ñ‹Ñ€Ñƒ Ğ¶Ó™Ğ½Ğµ Ğ¶Ğ°Ğ»Ò“Ğ° Ğ°Ğ»Ñƒ/ÑĞ°Ñ‚Ñ‹Ğ¿ Ğ°Ğ»Ñƒ Ñ€Ó™ÑÑ–Ğ¼Ğ´ĞµÑƒ â€” Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° ÑˆĞ°Ñ€Ñ‚Ñ‚Ğ°Ñ€Ñ‹Ğ¼ĞµĞ½ ĞºĞµĞ»Ñ–ÑÑƒĞ´Ñ– Ğ±Ñ–Ğ»Ğ´Ñ–Ñ€ĞµĞ´Ñ–.
- ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ñ‚Ğ°ÑƒĞ°Ñ€Ğ»Ğ°Ñ€Ğ´Ñ‹Ò£ Ğ¼ĞµĞ½ÑˆÑ–Ğº Ğ¸ĞµÑÑ– ĞµĞ¼ĞµÑ, Ñ‚ĞµĞº ÑĞµÑ€Ğ²Ğ¸Ñ Ñ€ĞµÑ‚Ñ–Ğ½Ğ´Ğµ Ñ…Ğ°Ğ±Ğ°Ñ€Ğ»Ğ°Ğ½Ğ´Ñ‹Ñ€Ñƒ Ğ¼ĞµĞ½ Ğ¼Ó™Ğ¼Ñ–Ğ»Ğµ Ğ¶Ğ°ÑĞ°ÑƒÒ“Ğ° Ğ¼Ò¯Ğ¼ĞºÑ–Ğ½Ğ´Ñ–Ğº Ğ±ĞµÑ€ĞµĞ´Ñ–.
- Ğ¢Ğ°ÑƒĞ°Ñ€ ÑĞ°Ğ¿Ğ°ÑÑ‹Ğ½Ğ° ÑĞ°Ñ‚ÑƒÑˆÑ‹/Ğ¸ĞµÑÑ– Ğ¶Ğ°ÑƒĞ°Ğ¿ Ğ±ĞµÑ€ĞµĞ´Ñ–, Ğ°Ğ» Ğ´Ğ°ÑƒĞ»Ğ°Ñ€Ğ´Ñ‹ Ñ€ĞµÑ‚Ñ‚ĞµÑƒĞ³Ğµ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° ĞºÓ©Ğ¼ĞµĞºÑ‚ĞµÑĞµĞ´Ñ–.
      `.trim();
    }

    if (locale === 'zh') {
      return `
Onerinn ç”¨æˆ·åè®®ï¼ˆç®€è¦ï¼‰ï¼š

- ç”¨æˆ·åœ¨æ³¨å†Œæ—¶åº”æä¾›çœŸå®çš„ä¸ªäººä¿¡æ¯ã€‚
- åœ¨å¹³å°ä¸Šå‘å¸ƒå•†å“ã€ä¸‹å•ç§Ÿèµæˆ–è´­ä¹°ï¼Œè§†ä¸ºåŒæ„ Onerinn çš„æœåŠ¡æ¡æ¬¾ã€‚
- å¹³å°ä¸æ˜¯å•†å“æœ¬èº«çš„æ‰€æœ‰äººï¼Œè€Œæ˜¯æä¾›å‘å¸ƒä¿¡æ¯å’Œæ’®åˆäº¤æ˜“çš„æœåŠ¡å¹³å°ã€‚
- å•†å“è´¨é‡ç”±å–å®¶/å‡ºå€Ÿäººè´Ÿè´£ï¼Œå¹³å°åœ¨äº‰è®®æ—¶æä¾›åè°ƒä¸æ”¯æŒã€‚
      `.trim();
    }

    return `
Onerinn User Agreement (short version):

- Users must provide truthful information when registering.
- Listing items or placing rental/purchase orders means the user agrees to the platform terms.
- The platform is not the owner of the goods; it only provides listing and transaction services.
- The owner/seller is responsible for product quality; the platform helps mediate disputes.
    `.trim();
  }

  // âœ… éšç§æ”¿ç­– / Privacy Policy
  if (isPrivacy) {
    if (locale === 'ru') {
      return `
ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ñ€ĞµĞ·ÑĞ¼Ğµ ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ´ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Onerinn:

- ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ (Ğ¸Ğ¼Ñ, ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸ Ğ´Ñ€.) Ğ² Ñ†ĞµĞ»ÑÑ… Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸, Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸, Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ¸Ñ ÑƒÑĞ»ÑƒĞ³ Ğ¸ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ°.
- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ´Ğ°ÑÑ‚ÑÑ Ñ‚Ñ€ĞµÑ‚ÑŒĞ¸Ğ¼ Ğ»Ğ¸Ñ†Ğ°Ğ¼, Ğ·Ğ° Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸ĞµĞ¼ ÑĞ»ÑƒÑ‡Ğ°ĞµĞ², Ğ¿Ñ€ĞµĞ´ÑƒÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ°ĞºĞ¾Ğ½Ğ¾Ğ¼ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ñ… Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ½Ñ‹Ğ¼ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ğ°Ğ¼).
- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ ÑƒÑ‚Ğ¾Ñ‡Ğ½ĞµĞ½Ğ¸Ğµ Ğ¸Ğ»Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ²Ğ¾Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ñ€Ğ°Ğ¼ĞºĞ°Ñ… Ğ´ĞµĞ¹ÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ·Ğ°ĞºĞ¾Ğ½Ğ¾Ğ´Ğ°Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ°.
      `.trim();
    }

    if (locale === 'kk') {
      return `
Onerinn Ò›Ò±Ğ¿Ğ¸ÑĞ»Ñ‹Ò› ÑĞ°ÑÑĞ°Ñ‚Ñ‹ (Ò›Ñ‹ÑÒ›Ğ°ÑˆĞ°):

- Ğ–ĞµĞºĞµ Ğ´ĞµÑ€ĞµĞºÑ‚ĞµÑ€ (Ğ°Ñ‚Ñ‹, e-mail, Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½) ĞµÑĞµĞ¿Ñ‚Ñ–Ğº Ğ¶Ğ°Ğ·Ğ±Ğ° Ğ¶Ò±Ğ¼Ñ‹Ñ Ñ–ÑÑ‚ĞµÑƒÑ– Ğ¶Ó™Ğ½Ğµ Ñ…Ğ°Ğ±Ğ°Ñ€Ğ»Ğ°Ğ½Ğ´Ñ‹Ñ€ÑƒĞ»Ğ°Ñ€ Ò¯ÑˆÑ–Ğ½ Ò›Ğ¾Ğ»Ğ´Ğ°Ğ½Ñ‹Ğ»Ğ°Ğ´Ñ‹.
- Ğ”ĞµÑ€ĞµĞºÑ‚ĞµÑ€ Ğ·Ğ°Ò£Ğ´Ğ° ĞºÓ©Ğ·Ğ´ĞµĞ»Ğ³ĞµĞ½ Ğ¶Ğ°Ò“Ğ´Ğ°Ğ¹Ğ»Ğ°Ñ€Ğ´Ñ‹ Ò›Ğ¾ÑĞ¿Ğ°Ò“Ğ°Ğ½Ğ´Ğ°, Ò¯ÑˆÑ–Ğ½ÑˆÑ– Ñ‚Ò±Ğ»Ò“Ğ°Ğ»Ğ°Ñ€Ò“Ğ° Ğ¿Ğ°Ğ¹Ğ´Ğ°Ğ»Ğ°Ğ½ÑƒÑˆÑ‹ ĞºĞµĞ»Ñ–ÑÑ–Ğ¼Ñ–Ğ½ÑÑ–Ğ· Ğ±ĞµÑ€Ñ–Ğ»Ğ¼ĞµĞ¹Ğ´Ñ–.
- ĞŸĞ°Ğ¹Ğ´Ğ°Ğ»Ğ°Ğ½ÑƒÑˆÑ‹ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚ Ğ¿ĞµĞ½ Ğ¾Ò“Ğ°Ğ½ Ğ±Ğ°Ğ¹Ğ»Ğ°Ğ½Ñ‹ÑÑ‚Ñ‹ Ğ´ĞµÑ€ĞµĞºÑ‚ĞµÑ€Ğ´Ñ– Ğ¶Ğ¾ÑĞ´Ñ‹ ÑÒ±Ñ€Ğ°Ğ¹ Ğ°Ğ»Ğ°Ğ´Ñ‹.
      `.trim();
    }

    if (locale === 'zh') {
      return `
Onerinn éšç§æ”¿ç­–ï¼ˆç®€è¦ï¼‰ï¼š

- ä¸ªäººä¿¡æ¯ï¼ˆå§“åã€é‚®ç®±ã€æ‰‹æœºå·ï¼‰ä»…ç”¨äºè´¦å·ç™»å½•ã€é€šçŸ¥å’Œå¹³å°è¿è¥ã€‚
- é™¤æ³•å¾‹è¦æ±‚æˆ–å¾å¾—ç”¨æˆ·åŒæ„å¤–ï¼Œå¹³å°ä¸ä¼šå‘æ— å…³ç¬¬ä¸‰æ–¹æä¾›ä¸ªäººæ•°æ®ã€‚
- ç”¨æˆ·å¯ä»¥ç”³è¯·åˆ é™¤è´¦å·ä»¥åŠç›¸å…³ä¸ªäººä¿¡æ¯ã€‚
      `.trim();
    }

    return `
Onerinn Privacy Policy (short):

- Personal data (name, e-mail, phone) is used only for account operations and notifications.
- Data is not shared with third parties without consent, except when required by law.
- Users can request deletion of their account and related personal data.
    `.trim();
  }

  // é»˜è®¤ï¼šæ²¡æœ‰ç‰¹å®šé¡µé¢ä¸Šä¸‹æ–‡æ—¶
  return '';
}

export async function POST(req: NextRequest) {
  try {
    const json = await req.json();

    const locale: string = json.locale || 'en';
    const messages = json.messages || [];
    const pageContext = req.headers.get('x-page-context') || '';
    const attachments = json.attachments || []; // å‰ç«¯ä¼ æ¥çš„æ–‡ä»¶ä¿¡æ¯ï¼ˆåç§°ã€ç±»å‹ç­‰ï¼‰

    const kb = getPageKnowledge(pageContext, locale);

    const attachmentText =
      Array.isArray(attachments) && attachments.length > 0
        ? `The user also attached files: ${attachments
            .map(
              (f: any, idx: number) =>
                `${idx + 1}) ${f.name || 'file'} (${f.type || 'unknown type'}, ${
                  f.size ? f.size + ' bytes' : 'size unknown'
                })`,
            )
            .join('; ')}.`
        : '';

    const sysPrompt = `
You are the official assistant of the Onerinn platform.
You must always answer in: ${languageName(locale)}.

Platform context:
- Current page: ${pageContext || 'unknown'}
- Knowledge base snippet:
${kb || '(no extra page-specific knowledge provided yet)'}
${attachmentText ? '\n' + attachmentText : ''}

Your responsibilities:
- Help users with questions about Onerinn, rentals, artworks, user accounts, payments and rules.
- When the question relates to the above knowledge base, follow it strictly.
- If you are not sure or information is missing, say that you are not sure and suggest contacting human support.

Keep answers friendly, concise and practical.
    `.trim();

    const openaiMessages = [
      { role: 'system', content: sysPrompt },
      ...messages.map((m: any) => ({
        role: m.role,
        content: m.content,
      })),
    ];

    let reply = '';

    // ğŸ”¹ 1) ä¼˜å…ˆä½¿ç”¨ Chat Completionsï¼ˆgpt-4o-miniï¼Œæ ‡å‡†èŠå¤©æ¥å£ï¼‰
    try {
      const completion = await client.chat.completions.create({
        model: 'gpt-4o-mini',
        messages: openaiMessages as {
          role: 'system' | 'user' | 'assistant';
          content: string;
        }[],
        temperature: 0.3,
        max_tokens: 600,
      });

      reply = completion.choices[0]?.message?.content?.trim() || '';
    } catch (chatErr) {
      console.error('Chat Completions error, fallback to Responses API:', chatErr);

      // ğŸ”¹ 2) å¦‚æœ Chat Completions å‡ºé”™ï¼Œé€€å›åˆ°ä½ åŸæ¥çš„ Responses API é€»è¾‘
      try {
        const response = await client.responses.create({
          model: 'gpt-4o-mini',
          input: openaiMessages,
        });

        // ä¿ç•™ä½ ä¹‹å‰çš„è§£ææ–¹å¼
        try {
          // @ts-ignore æ–°ç‰ˆ SDK çš„ä¾¿æ·å­—æ®µ
          reply = (response as any).output_text ?? '';
          if (!reply) {
            // å…¼å®¹è€æ ¼å¼
            // @ts-ignore
            const first = (response as any).output?.[0]?.content?.[0];
            // @ts-ignore
            reply = first?.text ?? '';
          }
        } catch {
          reply = '';
        }
      } catch (respErr) {
        console.error('Responses API fallback error:', respErr);
      }
    }

    // ğŸ”¹ å¦‚æœä¸¤å±‚éƒ½æ²¡æ‹¿åˆ°æ–‡æœ¬ï¼Œç”¨ä¸€ä¸ªæŒ‰è¯­è¨€åŒºåˆ†çš„å…œåº•æ–‡æ¡ˆ
    if (!reply) {
      reply =
        locale === 'ru'
          ? 'Ğ˜Ğ·Ğ²Ğ¸Ğ½Ğ¸Ñ‚Ğµ, Ñ Ğ½Ğµ ÑĞ¼Ğ¾Ğ³ ÑÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚.'
          : locale === 'kk'
          ? 'ĞšĞµÑˆÑ–Ñ€Ñ–Ò£Ñ–Ğ·, Ğ¶Ğ°ÑƒĞ°Ğ¿Ñ‚Ñ‹ Ò›Ğ°Ğ»Ñ‹Ğ¿Ñ‚Ğ°ÑÑ‚Ñ‹Ñ€Ğ° Ğ°Ğ»Ğ¼Ğ°Ğ´Ñ‹Ğ¼.'
          : locale === 'zh'
          ? 'æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ²¡èƒ½ç”Ÿæˆå›å¤ã€‚'
          : 'Sorry, I could not generate a reply.';
    }

    return NextResponse.json({ reply });
  } catch (err) {
    console.error('Chat API error:', err);
    return NextResponse.json(
      { reply: null, error: 'Server error' },
      { status: 500 },
    );
  }
}
